商品销售管理数据库是一个用来秘密管理商品销售信息的数据库系统。该数据库
销售管理系统数据库设计







班级  ______________________

姓名  ______________________

学号  ______________________

成绩  ______________________

日期 ______________________
  销售管理系统数据库设计说明书
一、数据库系统功能简介（5分）:
商品销售管理数据库是一个用来秘密管理商品销售信息的数据库系统。该数据库可以用来管理企业的商品信息、部门信息、员工信息、供应商信息、客户信息以及采购信息和销售信息，实现信息的自动化管理和利用。
需求分析（10分）
销售管理数据库的数据流程图
 

















三、概念结构设计（10分）
销售管理数据库的E-R图
 




                   SHAPE  \* MERGEFORMAT     
   
 
    
 
  
    

   
  
四、逻辑结构设计（5分）
销售管理数据库关系模式：
（1）部门（部门编号，部门名称，部门主管，备注）
（2）员工（员工编号，姓名，性别，出生年月，聘任日期，工资，部门编号）
（3）商品（商品编号，商品名称，单价，库存量，已销售量） 
（4）客户（客户编号，公司名称，联系人姓名，电话，地址，Email）
（5）供应商（供应商编号，供应商名称，联系人姓名，电话，地址，Email）
（6）采购订单（采购订单号，商品编号，员工号，供应商编号，订购数量，订购日期） 
（7）销售订单（销售订单号，商品编号，员工号，客户号，订购数量，订购日期）
五、物理结构设计（5分）
为销售管理数据库设计一个数据文件，一个日志文件，放在D盘的data文件夹下；销售管理数据库里面包含7个表，分别为商品、部门、员工、供应商、客户以及采购订单和销售订单；数据库和数据表的结构定义请看后面创建对象的SQL语句。
部门表
列名	数据类型	宽度	为空性	说明		部门编号	int			主关键字		部门名称	varchar	30		唯一键		部门主管	char	8	√			备注	varchar	50	√			员工表
列名	数据类型	宽度	为空性	说明		员工编号	int			主关键字		姓名	varchar	20				性别	char	2	√	取值为男或女		出生年月	smalldatetime		√			聘任日期	smalldatetime		√			工资	money		√	取值范围800-100000		部门编号	int		√	来自“部门表”的外键		供应商表
列名	数据类型	宽度	为空性	说明		供应商编号	int			主关键字		供应商名称	varchar	50				联系人姓名	char	8	√			电话	varchar	13	√	电话长度为7-13位字符		地址	varchar	100	√			E-mail	varchar	30	√	E-mail地址包含“@”		客户表
列名	数据类型	宽度	为空性	说明		客户编号	int			主关键字		公司名称	varchar	50				联系人姓名	char	8	√			电话	varchar	13	√	电话长度为7-13位字符		地址	varchar	100	√			E-mail	varchar	30	√	E-mail地址包含“@”		商品表
列名	数据类型	宽度	为空性	说明		商品编号	int			主关键字		商品名称	varchar	50				单价	Decimal(8,2)		√	单价大于0		库存量	int		√	库存量为非负数		已售数量	int		√	已售数量为非负数		采购订单表
列名	数据类型	宽度	为空性	说明		采购订单号	int			主关键字		商品编号	int		√	来自商品表的外键		员工编号	int		√	来自员工表的外键		供应商编号	int		√	来自供应商表的外键		订购数量	int		√			订购日期	smalldatetime					销售订单表
列名	数据类型	宽度	为空性	说明		销售订单号	int			主关键字		商品编号	int		√	来自商品表的外键		员工编号	int		√	来自员工表的外键		客户编号	int		√	来自客户表的外键		订购数量	int		√			订购日期	smalldatetime					
六、数据库的实施（共65分）
创建数据库各种对象和执行查询的SQL语句
1.创建数据库（5分）
create database 销售管理
on primary
(name=Sales_data,
 filename='d:\data\Sale_data.mdf',
 size=10mb,
 maxsize=unlimited,
filegrowth=10%)
log on
(name=Sales_log,
 filename='d:\data\Sale_log.ldf',
 size=3mb,
 maxsize=5mb,
filegrowth=1mb)
2.创建数据表并给表添加数据（20分）
use 销售管理
go
create table 部门
(部门编号 int primary key,
 部门名称 varchar(30) not null constraint UQ_DName unique,
 部门主管 char(8),
 备注 varchar(50))
go
create table 员工
(员工编号 int primary key,
 姓名    varchar(20) not null, 
 性别    char(2) default '男' check(性别='男'or 性别='女'),
 出生年月 smalldatetime,
 聘任日期 smalldatetime,
 工资    money check(工资between 800 and 100000),
 部门编号 int foreign key(部门编号) references 部门(部门编号))
go
create table 供应商
(供应商编号 int primary key,
 供应商名称 varchar(50) not null, 
 联系人姓名 char(8),
 电话 char(13) check(len(电话)>=7 and len(电话)<=13),
 地址 varchar(100),
 "E-mail"   varchar(30) check("E-mail" like '%@%'))
go
create table 客户
(客户编号 int primary key,
 公司名称 varchar(50) not null, 
 联系人姓名 char(8),
 电话 char(13) check(len(电话)>=7 and len(电话)<=13),
 地址 varchar(100),
 "E-mail" varchar(30) check("E-mail" like '%@%'))
go
create table 商品
(商品编号 int primary key,
 商品名称 varchar(50) not null, 
 单价     decimal(8,2) check(单价>0),
 库存量  int check(库存量>=0),
 已销售量 int check(已销售量>=0))
go
create table 采购订单
(采购订单号 int primary key,
 商品编号 int references 商品(商品编号),
 员工编号 int references 员工(员工编号),
供应商编号 int references 供应商(供应商编号),
订购数量 int,
订购日期 smalldatetime default getdate())
 go
create table 销售订单
(销售订单号 int primary key,
 商品编号 int references 商品(商品编号),
 员工编号 int references 员工(员工编号),
客户编号 int references 客户(客户编号),
订购数量 int,
订购日期 smalldatetime default getdate())

表添加的数据如下图所示：
 
 
 
 
 
 
 
3.创建数据库各种对象（共25分）
a.创建试图（5分）：创建一个客户订购情况的视图，包括客户编号，公司名称，商品编号，商品名称，单价和订购数量，并对视图进行加密。
create view 客户订购情况
with encryption
as
select a.客户编号,公司名称,c.商品编号,商品名称,单价,订购数量
  from 客户 a join 销售订单 as b on a.客户编号=b.客户编号
  join 商品 as c on c.商品编号=b.商品编号
b.创建索引（5分）：在销售管理系统中，经常要按照客户名称查询信息，通过给客户表的公司名称创建一个唯一非聚集索引来提高查询速度。
Create unique index ix_cname
On 客户(公司名称)
c.创建用户定义函数（5分）：创建标量函数，根据商品名称统计某种商品销售的次数
create function 销售次数
(@商品名称 varchar(50)='路由器')
returns int
begin
declare @销售次数 int
select @销售次数=count(*)
from 商品 join 销售订单
on 商品.商品编号=销售订单.商品编号
where 商品名称=@商品名称
return @销售次数
end
执行函数：
select dbo.销售次数('鼠标') as 销售次数
select dbo.销售次数(default)
d. 创建存储过程（5分）: 创建一个名为客户订购信息存储过程，用于查询指定客户的联系人姓名、联系方式、以及该公司订购产品的明细表。
create proc 客户订购信息
(@客户名称 varchar(50)='通恒机械有限公司')
as
select 公司名称,联系人姓名,商品名称,单价,订购数量,订购日期
from 客户join 销售订单
On 客户.客户编号=销售订单.客户编号
join 商品
on 商品.商品编号=销售订单.商品编号
where 公司名称=@客户名称
执行输入参数为默认值的存储过程：
exec 客户订购信息
执行带输入参数的存储过程：
exec 客户订购信息 '三川实业有限公司
e. 创建触发器（5分）: 创建一个触发器实现当向销售订单表添加一条记录时，自动修改商品表的库存数量和已售数量。

create trigger 销售
on 销售订单
after insert
as
update 商品
set 库存数量=库存数量-订购数量,
已售数量=已售数量+订购数量
from 商品 join inserted
on 商品.商品编号=inserted.商品编号
4.执行查询（共15分）
(1)简单查询（2分）：从客户表中检索所有客户的公司名称、联系人姓名和地址。
 select 公司名称,联系人姓名,地址  from 客户
(2) 条件查询（3分）：在销售管理数据库的销售订单表中，查询员工编号为1、5和7的员工接受订单信息。 
select * from 销售订单 where 员工编号in(1,5,7)
（3）统计查询（2分）：统计所有员工的平均工资、最高工资、最低工资和工资总和。
select avg(工资) as 平均工资,max(工资) as 最高工资,min(工资) as 最低工资,sum(工资) as 工资总和 from 员工
（4）分组查询（3分）：查询男女员工的平均工资。
  select 性别,avg(工资) as 平均工资 from 员工 group by 性别
（5）多表查询（2分）：查询“国皓科技有限公司”订购的商品信息，包括客户编号，公司名称，商品编号，商品名称，商品价格，订购数量。
  select a.客户编号,公司名称,c.商品编号,商品名称,单价,订购数量
  from 客户 a join 销售订单 as b on a.客户编号=b.客户编号
  join 商品 as c on c.商品编号=b.商品编号
  where 公司名称='国皓科技有限公司‘
（6）嵌套查询（3分）：查询比平均工资高的员工的姓名和工资。
select 姓名,工资  from 员工
where 工资>(select avg(工资) from 员工)
 

 

 

 


                                                                                                                            
装        订        线                 考    生    答    题     不    得     超    过    此    线             

商品号

商品名称

单价

库存量

已售数量

电话

客户编号

联系人姓名

公司名称

出生年月

联系人姓名

供应商名称

供应商编号号

商品

员工

客户

供应商

采购

销售

1

m

n

m

订购日期

订购数量

订购日期

订购数量

Email

性别

员工编号

姓名

奖金

n

m

m

n

m

工资

电话

聘任日期

Email




地址

Email

地址

属于

部门主管

部门编号

1

备注

部门名称

部门



 